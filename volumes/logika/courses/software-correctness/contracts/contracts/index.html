<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="var x: Z = 0 def incBy(y: Z): Z = { Contract( Requires(y &amp;gt; 0), // pre-condition Modifies(x), // frame-condition Ensures(x == In(x) &#43; y &amp;amp; x &amp;gt; In(x) &amp;amp; Res == x) // post-condition ) x = x &#43; y return x } In this example (contrived for the purpose of illustration), a &amp;ldquo;global&amp;rdquo; variable x is defined, and an incBy method is defined to increment x by the value supplied via parameter y." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://doc.sireum.org/volumes/logika/courses/software-correctness/contracts/contracts/" />


    <title>
        
            Contract Reasoning :: Sireum Doc 
        
    </title>



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.14/themes/default/style.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.14/themes/default-dark/style.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://doc.sireum.org/_pagefind/pagefind-ui.css">




<link rel="stylesheet" href="https://doc.sireum.org/main.9b7fec326fab4b320f3a6ebff5b2cd1a56f40af9971ff15a0213c97eff1ce5d0.css" integrity="sha256-m3/sMm&#43;rSzIPOm6/9bLNGlb0CvmXH/FaAhPJfv8c5dA=">



    <link rel="apple-touch-icon" sizes="180x180" href="https://doc.sireum.org/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://doc.sireum.org/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://doc.sireum.org/favicon-16x16.png">
    <link rel="manifest" href="https://doc.sireum.org/site.webmanifest">
    <link rel="mask-icon" href="https://doc.sireum.org/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="https://doc.sireum.org/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Contract Reasoning">
<meta itemprop="description" content="var x: Z = 0 def incBy(y: Z): Z = { Contract( Requires(y &gt; 0), // pre-condition Modifies(x), // frame-condition Ensures(x == In(x) &#43; y &amp; x &gt; In(x) &amp; Res == x) // post-condition ) x = x &#43; y return x } In this example (contrived for the purpose of illustration), a &ldquo;global&rdquo; variable x is defined, and an incBy method is defined to increment x by the value supplied via parameter y.">

<meta itemprop="wordCount" content="2443"><meta itemprop="image" content="https://doc.sireum.org"/>
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://doc.sireum.org"/>

<meta name="twitter:title" content="Contract Reasoning"/>
<meta name="twitter:description" content="var x: Z = 0 def incBy(y: Z): Z = { Contract( Requires(y &gt; 0), // pre-condition Modifies(x), // frame-condition Ensures(x == In(x) &#43; y &amp; x &gt; In(x) &amp; Res == x) // post-condition ) x = x &#43; y return x } In this example (contrived for the purpose of illustration), a &ldquo;global&rdquo; variable x is defined, and an incBy method is defined to increment x by the value supplied via parameter y."/>
















    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="menu-trigger">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
        </svg>
    </span>
    <span class="header__inner">
        <a href="https://doc.sireum.org/" style="text-decoration: none;">
    <div class="logo">
        
            <img class="color-scheme" src="https://doc.sireum.org/img/santos/icon-doc.png" alt="">
            &nbsp;<span class="logo__text">Doc</span>
        
    </div>
</a>


        <span class="header__right">
            
                

<nav class="menu">
  <ul class="menu__inner">
  
  
    
      <div class="submenu">
        <li class="dropdown" onmouseover="menuDisplay(this.children[1], true);" onmouseout="menuDisplay(this.children[1], false);">
          <a class="dropbtn" href="https://doc.sireum.org/volumes/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Volumes&nbsp;<small>ᐁ</small></span>
            <span class="responsive-title-short">Volumes&nbsp;<small>ᐁ</small></span>
          </a>
          <div class="dropdown-content" align="left">
            <ul style="margin:8px;">
              
                
  
  
    
      <div>
        <li>
          <a href="https://doc.sireum.org/volumes/slang/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Slang</span>
            <span class="responsive-title-short">Slang</span>
          </a>
        </li>
      </div>
    
  

              
                
  
  
    
      <div>
        <li>
          <a href="https://doc.sireum.org/volumes/hamr/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">HAMR</span>
            <span class="responsive-title-short">HAMR</span>
          </a>
        </li>
      </div>
    
  

              
                
  
  
    
      <div>
        <li>
          <a href="https://doc.sireum.org/volumes/logika" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Logika</span>
            <span class="responsive-title-short">Logika</span>
          </a>
        </li>
      </div>
    
  

              
            </ul>
          </div>
        </li>
      </div>
    
  

  
  
    
      <div class="submenu">
        <li class="dropdown" onmouseover="menuDisplay(this.children[1], true);" onmouseout="menuDisplay(this.children[1], false);">
          <a class="dropbtn" href="https://doc.sireum.org/venues/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Venues&nbsp;<small>ᐁ</small></span>
            <span class="responsive-title-short">Venues&nbsp;<small>ᐁ</small></span>
          </a>
          <div class="dropdown-content" align="left">
            <ul style="margin:8px;">
              
                
  
  
    
      <div>
        <li>
          <a href="https://doc.sireum.org/venues/tutorials/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Tutorials</span>
            <span class="responsive-title-short">Tutorials</span>
          </a>
        </li>
      </div>
    
  

              
                
  
  
    
      <div>
        <li>
          <a href="https://doc.sireum.org/venues/presentations/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Presentations</span>
            <span class="responsive-title-short">Presentations</span>
          </a>
        </li>
      </div>
    
  

              
            </ul>
          </div>
        </li>
      </div>
    
  

  
  
    
      <div>
        <li>
          <a href="https://sireum.org/getting-started/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Download</span>
            <span class="responsive-title-short">Download</span>
          </a>
        </li>
      </div>
    
  

  
  
    
      <div>
        <li>
          <a href="https://sireum.org/papers" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Papers</span>
            <span class="responsive-title-short">Papers</span>
          </a>
        </li>
      </div>
    
  

  
  
    
      <div>
        <li>
          <a href="https://sireum.org/funding" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Funding</span>
            <span class="responsive-title-short">Funding</span>
          </a>
        </li>
      </div>
    
  

  
  
    
      <div>
        <li>
          <a href="https://sireum.org/team" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Team</span>
            <span class="responsive-title-short">Team</span>
          </a>
        </li>
      </div>
    
  

  </ul>
</nav>

            
        </span>
    </span>
        <span class="theme-toggle not-selectable" style="margin-right: 10px"><img src="https://doc.sireum.org/img/toggle.png" height="20px"></span>
      <div class="submenu">
          <li class="dropdown" onmouseover="menuDisplay(this.children[1], true); searchFocus();" onmouseout="menuDisplay(this.children[1], false);">
              <a class="dropbtn fa fa-search"></a>
              <div class="dropdown-content" align="left">
                  <div id="search" style="z-index:2147483647; position: fixed;"></div>
              </div>
          </li>
      </div>
    
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://doc.sireum.org/volumes/logika/courses/software-correctness/contracts/contracts/">Contract Reasoning</a></h2>

            
            
            

            <div class="post-content">
                <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">var</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">incBy</span><span class="o">(</span><span class="n">y</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">),</span>                                <span class="c1">// pre-condition
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nc">Modifies</span><span class="o">(</span><span class="n">x</span><span class="o">),</span>                                    <span class="c1">// frame-condition
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nc">Ensures</span><span class="o">(</span><span class="n">x</span> <span class="o">==</span> <span class="nc">In</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">+</span> <span class="n">y</span> <span class="o">&amp;</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="nc">In</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">&amp;</span> <span class="nc">Res</span> <span class="o">==</span> <span class="n">x</span><span class="o">)</span>  <span class="c1">// post-condition
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">x</span> <span class="k">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>In this example (contrived for the purpose of illustration),
a &ldquo;global&rdquo; variable <code>x</code> is defined, and an <code>incBy</code> method is
defined to increment <code>x</code> by the value supplied via parameter <code>y</code>.
As a conveniece the method returns the value of <code>x</code> after the
increment.</p>
<p>The method has a contract made up of several parts:</p>
<ul>
<li>a <em>pre-condition</em> stated using the <code>Requires</code> keyword that
indicates properties that must hold when the method is called.  In
this case, the method should always be called with the parameter
<code>y</code> having a value greater than <code>0</code>.  The Logika verifier will
automatically check that all calls to the method fulfill this
property.</li>
<li>a <em>post-condition</em> stated using the <code>Ensures</code> keyword indicates
properties that must hold when the the method completes and control
returns to the caller.  In this case, the method should ensure that
the value of <code>x</code> in the post-state is equal to the value of <code>x</code>
in the pre-state plus the value of <code>y</code>.  Slang provides the <code>In</code>
notation to enable expressions in the post-condition and other proof
contexts to reference the value of <code>x</code> in the pre-state (<code>In</code> is
not used in the pre-condition because pre-condition expressions
are always/only interpreted in terms of the pre-state). The method
should also ensure that the resulting value of the method is equal
to the value of <code>x</code> in the post-state.  Slang provides the <code>Res</code>
notation to refer to method&rsquo;s return value.   The Logika verifier will
automatically check that the method implementation fulfills this
property (guaranteeing that all possible calls/executions of the
method that satisfy the pre-condition will lead to the
post-condition being satisfied).</li>
<li>a <em>frame condition</em> stated using the <code>Modifies</code> keyword indicates
the variables visible &ldquo;outside&rdquo; of the method (e.g., &ldquo;global&rdquo; variables) that may be modified due to
the method&rsquo;s execution (it implicitly indicates that the method must
not modify any other variables outside the method).
This is useful for clients of the method to
know because if they were depending on properties of variables
listed in the modifies clause, the
clause indicates that those properties may
be invalidated due to changes in the variables.  Contract elements
like <code>modifies</code> (different names/keywords are used in different
contract languages) have historically been called frame conditions
because they &ldquo;frame&rdquo; the state of the
program that (a) the method may change and (b) the method
must not change.</li>
</ul>
<h3 id="assume--guarantee-reasoning">Assume / Guarantee Reasoning</h3>
<p>In general, method contracts capture properties that client code
(code that calls the method) should understand to be able to invoke
the method correctly and to correctly rely on its results.</p>
<h4 id="client-perspective">Client Perspective</h4>
<p>The following illustrates a call by a client of the <code>incBy</code>
&ldquo;service&rdquo;. Comments have been added to code to indicate the
verification obligations that met before calling the service as well
as the knowledge that the client can rely on after the call (<strong>note:</strong> we use the special symbol <code>x_old</code> after the call to <code>incBy</code> to refer to the value of <code>x</code> before the call):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">a</span> <span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// V-OBLG: client must guarantee pre-condition is satisfied
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//   pre-condition interpreted in calling context:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//     a &gt; 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">z</span> <span class="k">=</span> <span class="n">incBy</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// V-KNOW: client gets to assume that post-condition is satisfied
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//   post-condition interpreted in calling context:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//     x == x_old + a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//     x &gt; x_old
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//     z == x
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="c1">// V-KNOW: client gets to assume that no variable in its context
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//   other than x is changed.  In particular, a has not changed,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//   so any knowledge of a before the call is still valid after the
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//   call.
</span></span></span></code></pre></div><p>Before the call, the client must guarantee that the pre-condition is
satisfied.  The method&rsquo;s precondition <code>y &gt; 0</code> is stated in terms of its formal
parameter <code>y</code>.  For some intuition about how the precondition applies to the
calling context, we can view the formal parameter <code>y</code> to be instantiated with the
actual parameter <code>a</code> in the contract precondition to obtain the verification obligation <code>a &gt; 0</code> that must be met in the calling context immediately before the call.</p>
<p><img src="../images/contracts-incBy-client-pre.png" alt="Assume/Guarantee - Client - Pre-condition"></p>
<p>Logika marks this verification obligation with a bolt at the call site at <strong>Line 26</strong> as shown in the figure above.   The verification obligation sequent shown in the right pane indicates that the Logika process is actually a bit less direct than the intuition presented above.</p>
<pre tabindex="0"><code>; x@5 === 0,     // initialization of x
; x === 5,       // assignment to x
; temp === x,    // assignment to temp
; a === 4,       // assignment to a
; y === a        // bind caller&#39;s actual parameter a to formal parameter y of called method
; ⊢
; y &gt; 0          // check that pre-condition of called procedure is satisfied
</code></pre><p>In particular, as illustrated in the comments in the sequent above, the sequent antecedents include known facts resulting from assignment statements.  The effect of a substitution of the actual parameter for the formal parameter described in the &ldquo;intuition&rdquo; above is realized as an equality constraint between the formal parameter <code>y</code> and the actual parameter <code>a</code>.   Given this equality constraint, the constraint <code>y &gt; 0</code> to be verified is equivalent to <code>a &gt; 0</code>.</p>
<p>After the call, the client gains knowledge based on what the service
stated it would achieve in the post-condition.  <code>incBy</code> has three
clauses in its post-condition:</p>
<ul>
<li><code>x == In(x) + y</code></li>
<li><code>x &gt; In(x)</code></li>
<li><code>Res == x</code></li>
</ul>
<p>Clicking on the light bulb for the assertion at <strong>Line 28</strong> reveals known facts that include constraints from the called methods contract (excerpts are shown below).
Note that the identifiers for logic variables generated from the message contract are prefixed by &ldquo;incBy. ..&rdquo;.</p>
<pre tabindex="0"><code>...
At[Z](&#34;incBy.y&#34;, 0) == a;   // binding of formal parameter ``y`` to actual parameter ``a``
At[Z](&#34;incBy.y&#34;, 0) &gt; 0;    // pre-condition
x == At(x, 1) + At[Z](&#34;incBy.y&#34;, 0) &amp; x &gt; At(x, 1) &amp;  
     At[Z](&#34;incBy.Res&#34;, 0) == x; // post-condition
z == At[Z](&#34;incBy.Res&#34;, 0)  // binding of return value to context variable ``z`` receiving 
                            //   result of called method
</code></pre><p>These facts, resulting from called method&rsquo;s contract, gives knowledge that the client can rely on after the call.</p>
<p><img src="../images/contracts-incBy-client-post-assertion.png" alt="Assume/Guarantee - Client - Assertion"></p>
<p>As shown in the bolt information for the assertion at <strong>Line 28</strong> in the figure above, this is sufficient information to verify that the updated value of <code>x</code> is greater than the value of <code>x</code> before the call (as reflected by the value of <code>temp</code>).</p>
<h4 id="service-perspective">Service Perspective</h4>
<p>We repeat the method code above, adding comments to indicate the reasoning
principles for the Assume/Guarantee paradigm from the service&rsquo;s perspective::</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">incBy</span><span class="o">(</span><span class="n">y</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Requires</span><span class="o">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Modifies</span><span class="o">(</span><span class="n">x</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Ensures</span><span class="o">(</span><span class="n">x</span> <span class="o">==</span> <span class="nc">In</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">+</span> <span class="n">y</span> <span class="o">&amp;</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="nc">In</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">&amp;</span> <span class="nc">Res</span> <span class="o">==</span> <span class="n">x</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// V-KNOW: Service gets to assume pre-condition is satisfied
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//   y &gt; 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">x</span> <span class="k">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// V-OBLG: Service must guarantee only non-local variable modified is x
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// V-OBLG: Service must guarantee post-condition
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//   x == In(x) + y
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//   x &gt; In(x)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//   x == x  (substituting x for Res in the post-condition)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span></code></pre></div><p>At the beginning of the method body, because all calls of the
method will be checked by Logika to ensure that the pre-condition is
satisfied, the service gets to assume (i.e., has the knowledge)
that <code>y &gt; 0</code>.  Corresponding to the idea of &ldquo;getting to assume&rdquo;, within the Logika verification process, the presence of the pre-condition <code>Requires(y &gt; 0)</code> causes <code>y &gt; 0</code> to be added to the set of known facts at the beginning of the method body.</p>
<p><img src="../images/contracts-incBy-pre.png" alt="Assume/Guarantee - Service - Pre-condition"></p>
<p>In the figure above, the developer has clicked on the lightbulb at the first line in the method (<strong>Line 13</strong>), and <code>y &gt; 0</code> appears in the known facts.</p>
<p>At the end of the method body, the implementer of
the service must guarantee that the post-condition has been met.
In the third clause of the post-condition, the <code>Res</code> keyword stands
for the result of the method.  From the implementor&rsquo;s perspective,
<code>Res</code> is computed by the expression used in the <code>return</code>
statement, in this case by the variable <code>x</code> from <code>return x</code>.
Corresponding to the idea of &ldquo;must guarantee&rdquo;, within the verification process, Logika will generate a verification obligation (corresponding to the presence of the lightning bolt at <strong>Line 11</strong>).</p>
<p><img src="../images/contracts-incBy-post.png" alt="Assume/Guarantee - Service - Post-condition"></p>
<p>In the figure above, the developer has clicked on the bolt at the contract post-condition, the the Logika output panel shows the sequent that needs to be proven.   Essentially, it needs to be shown that from the known facts at the end of the method that the post-condition can be established.  The listing below presents an annotated version of the sequent.</p>
<pre tabindex="0"><code>; Sequent:
;
; y &gt; 0,           // from pre-condition
; x === x@10 + y,  // from method body code
; Res === x        // setting the &#39;Res&#39; identifier to the value of the return expression
; ⊢
; (x == x@10 + y &amp; x &gt; x@10) &amp; Res == x  // post-condition
</code></pre><p>Even though our example method is trivial, the sequent reflects that general structure that one sees in Logika post-condition verification obligations for all methods.</p>
<p><em>Sequent Antecedent</em> (accumulated knowledge)</p>
<ul>
<li>known facts from pre-condition: the first fact corresponds to the constraint that one gets to assume from the pre-condition,</li>
<li>known facts from method body code: the second fact corresponds to the knowledge that Logika accumulates when processing the method body,</li>
<li>binding &lsquo;Res&rsquo; to result expression: the final fact introduces an equality constraint between (a) the keyword &lsquo;Res&rsquo; that the developer can use in contracts to refer to the methods return value and the (b) a logical expression corresponding to the return expression in the code (in this case, the single variable <code>x</code>),</li>
</ul>
<p><em>Sequent Consequent</em> (constraint to prove)</p>
<ul>
<li>the post-condition clause to be proven: the expression in the current post-condition clause is presented in terms of the logical variables of the method.  Note that the <code>In(x)</code> expressions from the post-condition are translated to a logic variable that identifies the value of <code>x</code> at the beginning of the method.</li>
</ul>
<p>For the contract frame condition (<code>Modifies</code> clause), the
method implementation must also guarantee that only externally visible variables modified in the method are listed in the <code>Modifies</code> clause (in this case, only <code>x</code> is modified).  Conceptually, this is a property
that is achieved throughout the method body&rsquo;s execution, not just at
the end of the method.  Logika will check this property holds as part of its automated verification process.</p>
<p><img src="../images/contracts-assume-guarantee-concept.png" alt="Assume/Guarantee - Concepts"></p>
<p>The figure above summarizes the key concepts associated with the assume/guarantee pattern, including how the called method&rsquo;s (service&rsquo;s) contract gives rise to verification obligation and verification knowledge for both the service and client.</p>
<p><strong>TBD: Insert exercises at this point</strong></p>
<h3 id="omitting-sections-of-a-method-contract">Omitting Sections of a Method Contract</h3>
<p>Sections of a method contract may be omitted.  The following abstract
value example <code>abs</code> does not include a pre-condition since it does
not need to make any assumptions about its inputs (i.e., it &ldquo;works&rdquo;
for all possible inputs of the argument type).   And, since the the
method does not modify a non-local variable, the <code>modifies</code> section
can be omitted::</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">absValue</span><span class="o">(</span><span class="n">y</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Ensures</span><span class="o">(</span><span class="nc">Res</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">var</span> <span class="n">ans</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">ans</span> <span class="k">=</span> <span class="o">-</span><span class="n">y</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">ans</span> <span class="k">=</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ans</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span></code></pre></div><p>Omitting a pre-condition is semantically equivalent to stating that
the pre-condition is always satisfied, no matter how the method is
called.  To emphasize this point, one can explicitly include a
<code>Requires</code> clause with a body <code>T</code>::</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">T</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="nc">Res</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span></code></pre></div><p>A trivial <code>Modifies</code> clause (one with no entries) can also be
included if one wishes to make a visually explicit indication that
&ldquo;nothing&rdquo; is modified::</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">T</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Modifies</span><span class="o">(),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="nc">Res</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span></code></pre></div><p>Post-conditions can also be omitted.  This is common early on in the
development process where one is prototyping and only using contracts
to indicate situations where bad inputs could cause problems like
run-time exceptions or where the input domain for which the method is
defined is limited.  For example, one might want to rule out negative
inputs for a square root or factorial function without saying anything
about the result::</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">factorial</span><span class="o">(</span><span class="n">y</span> <span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Requires</span><span class="o">(</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span></code></pre></div><p>In such situations, the service contract is making no &ldquo;promises&rdquo; to
clients about what the service will do.  However, it is still
provides valuable information by indicating that the function is only
defined for non-negative values.</p>
<h3 id="using-contracts-to-capture-important-properties-rather-than-full-behavior">Using Contracts to Capture Important Properties Rather Than Full Behavior</h3>
<p>The previous section illustrates an important point about the contract
paradigm: contracts do not always need to completely specify the
behavior of a method or system to be useful.   For example, the
<code>absValue</code> method contract did not completely specify the functional
behavior (e.g., indicating given a negative value <em>-v</em> that the
corresponding positive value <em>v</em> would be returned).   It simply
indicated that the result would be non-negative.</p>
<p><strong>Eventually say more here with additional examples</strong></p>
<h3 id="contract-cases">Contract Cases</h3>
<p>Sometimes contracts can be specified (and even verified) more easily
when they are organized according to different cases of input &ndash; and
Slang Contracts provides a special notation to support that.
<strong>Reference intuition for breaking proofs into cases from the math
world</strong>.</p>
<p>The following example illustrates a variant of the <code>absValue</code>
method/contract above that uses Slang&rsquo;s <em>contract cases</em>::</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">absValueCases</span><span class="o">(</span><span class="n">y</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Modifies</span><span class="o">(),</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// case for negative input
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nc">Case</span><span class="o">(</span><span class="s">&#34;Negative&#34;</span><span class="o">,</span>          <span class="c1">// optional string label
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="nc">Requires</span><span class="o">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">),</span>     <span class="c1">// condition on input for this case to apply
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="nc">Ensures</span><span class="o">(</span><span class="nc">Res</span> <span class="o">==</span> <span class="o">-</span><span class="n">y</span><span class="o">)</span>   <span class="c1">// post-condition for this case
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="o">),</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// case for non-negative input
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nc">Case</span><span class="o">(</span><span class="s">&#34;Non-negative&#34;</span><span class="o">,</span>      <span class="c1">// optional string label
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nc">Requires</span><span class="o">(</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>       <span class="c1">// condition on input for this case to apply
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nc">Ensures</span><span class="o">(</span><span class="nc">Res</span> <span class="o">==</span> <span class="n">y</span><span class="o">))</span>      <span class="c1">// post-condition for this case
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">var</span> <span class="n">ans</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">ans</span> <span class="k">=</span> <span class="o">-</span><span class="n">y</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">ans</span> <span class="k">=</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ans</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span></code></pre></div><p>There must be a single <code>Modifies</code> clause for contract cases (or the
clause can be omitted when no non-local is modified) because Logika
does not support a notion of conditional modification (this makes the
rest of the verification framework more challenging).</p>
<p>One or more [<strong>Robby is &ldquo;one or more correct&rdquo;?</strong>] <code>Case</code> clauses are
used, where each <code>Case</code> typically includes both a <code>Requires</code>
stating some condition on the input (the <em>case pre-condition</em>) and an
<code>Ensures</code> clause indicating the properties (the <em>case
post-condition</em>) that must hold in the post-state when the case
pre-condition is true.</p>
<p><strong>Address the following: overlapping requires, non-exhaustive
requires, ordering of cases (e.g., when overlapping), omitting
requires, omitting ensures.</strong></p>

            </div>
        </article>

        <hr />

        
<div style="display: grid; grid-template-columns: 2% 49% 49%; text-align: center;">
  <div class="submenu" style="background: transparent; text-align: left; position: relative;">
    <li class="dropdown" onmouseover="menuDisplay(this.children[1], true);" onmouseout="menuDisplay(this.children[1], false);">
      <a class="dropbtn" href=""><i class="fa-solid fa-angles-up"></i></a>
      <div class="dropdown-content" style="bottom: 100%;"><a class="post-item-inner" href="https://doc.sireum.org/volumes/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">Volumes</a><a class="post-item-inner" href="https://doc.sireum.org/volumes/logika/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">Logika</a><a class="post-item-inner" href="https://doc.sireum.org/volumes/logika/courses/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">Course Materials</a><a class="post-item-inner" href="https://doc.sireum.org/volumes/logika/courses/software-correctness/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">Logika Course: Software Correctness</a><a class="post-item-inner" href="https://doc.sireum.org/volumes/logika/courses/software-correctness/contracts/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">Contracts</a></div>
    </li>
  </div>
  <div style="text-align: left;">
    
      <a href="https://doc.sireum.org/volumes/logika/courses/software-correctness/contracts/require-ensure/" style="text-decoration: none;" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
        <i class="fa-solid fa-chevron-left"></i> Function Contracts
      </a>
    
  </div>
  <div style="text-align: right;">
    
      <a href="https://doc.sireum.org/volumes/logika/courses/software-correctness/contracts/assume-assert/" style="text-decoration: none;" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">Program Contracts
        <i class="fa-solid fa-chevron-right"></i>
      </a>
    
  </div>
</div>



        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js" integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin="anonymous"></script>



<script type="text/javascript" src="https://doc.sireum.org/bundle.min.d9847dec188cb3ba71e262769d7f64069d223c3a9713999a5da5f7aca5638686e15a900ac07cc755d19861961f24145ef2d608296933e4150cae87f4911a7dbb.js" integrity="sha512-2YR97BiMs7px4mJ2nX9kBp0iPDqXE5maXaX3rKVjhobhWpAKwHzHVdGYYZYfJBRe8tYIKWkz5BUMrof0kRp9uw=="></script>


<script defer type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/thecarnie-cycle2/2.1.6c/jquery.cycle2.min.js" integrity="sha512-ydWfQuPu+srw5hhkU8O1XGn3/Kc+GyoDBvYc8E+SyuZKphQP18ZWYKywIFzPWZwQk6dlmTY69aDg/SnFz3qPeQ==" crossorigin="anonymous"></script>
<script defer type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/js/all.min.js" integrity="sha512-rpLlll167T5LJHwp0waJCh3ZRf7pO6IT1+LZOhAyP6phAirwchClbTZV3iqL3BMrVxIYRbzGTpli4rfxsCK6Vw==" crossorigin="anonymous"></script>
<script defer type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.14/jstree.min.js" integrity="sha512-OQ2by9SrJBwcXaeYmkG2t6FVZiwpyRtFar2VvULjuq5OjVpJLwsUHuNzN9PClqEJAYsWsRPSb4TTfriZzPGiow==" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://doc.sireum.org/_pagefind/pagefind-ui.js"></script>
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', (event) => {
      new PagefindUI({
        element: "#search",
        showEmptyFilters: true,
        mergeIndex: [
          
            { bundlePath: "https:\/\/sireum.org\/_pagefind" },
          
            { bundlePath: "https:\/\/slang.sireum.org\/_pagefind" },
          
            { bundlePath: "https:\/\/logika.sireum.org\/_pagefind" },
          
        ]
      });
    });
  </script>
<script style="text/javascript">
  window.addEventListener('load', function () {
    $('#page-tree').jstree({
      "core": {
        "themes": {
          "name": document.documentElement.getAttribute("data-theme") == "dark" ? "default-dark" : "default",
          "dots": true,
          "icons": false,
          "variant": "large"
        }
      },
      plugins: [ "ui" ],
    }).bind("select_node.jstree", function (e, data) {
      document.location.href = data.node.a_attr.href;
    }).bind("ready.jstree", function (event, data) {
      $(this).jstree("open_all");
    }).bind("open_all.jstree", function (event, data) {
      level = 0;
      data.instance.element.find('li').each(function() {
        if (level > 0 && data.instance.get_path(this).length >= level){
          data.instance.close_node(this);
        }
      });
      data.instance.element.get()[0].style.display="block";
    });
  });
</script>


    </body>
</html>
