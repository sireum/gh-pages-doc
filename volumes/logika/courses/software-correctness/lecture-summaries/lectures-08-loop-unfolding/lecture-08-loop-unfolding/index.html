<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="Induction, Recursion, Iteration From Specification to Implementation Let&amp;rsquo;s review the material from last week, linking induction, recursion and iteration.
We have developed a correct implementation in three steps.
Describe the mathematical concepts necessary to express required program properties Create a (recursive) specification that is easy to understand (and validate) Implement an efficient solution for the specification We document clearly what is implemented by specifying it in mathematical terms. We document clearly why the implementation is correct by supplying a proof." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://doc.sireum.org/volumes/logika/courses/software-correctness/lecture-summaries/lectures-08-loop-unfolding/lecture-08-loop-unfolding/" />


    <title>
        
            Lecture Summary: Loop Unfolding :: Sireum Doc 
        
    </title>



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.14/themes/default/style.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.14/themes/default-dark/style.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://doc.sireum.org/_pagefind/pagefind-ui.css">




<link rel="stylesheet" href="https://doc.sireum.org/main.9b7fec326fab4b320f3a6ebff5b2cd1a56f40af9971ff15a0213c97eff1ce5d0.css" integrity="sha256-m3/sMm&#43;rSzIPOm6/9bLNGlb0CvmXH/FaAhPJfv8c5dA=">



    <link rel="apple-touch-icon" sizes="180x180" href="https://doc.sireum.org/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://doc.sireum.org/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://doc.sireum.org/favicon-16x16.png">
    <link rel="manifest" href="https://doc.sireum.org/site.webmanifest">
    <link rel="mask-icon" href="https://doc.sireum.org/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="https://doc.sireum.org/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Lecture Summary: Loop Unfolding">
<meta itemprop="description" content="Induction, Recursion, Iteration From Specification to Implementation Let&rsquo;s review the material from last week, linking induction, recursion and iteration.
We have developed a correct implementation in three steps.
Describe the mathematical concepts necessary to express required program properties Create a (recursive) specification that is easy to understand (and validate) Implement an efficient solution for the specification We document clearly what is implemented by specifying it in mathematical terms. We document clearly why the implementation is correct by supplying a proof."><meta itemprop="datePublished" content="2022-11-24T17:01:09+01:00" />
<meta itemprop="dateModified" content="2022-11-24T17:01:09+01:00" />
<meta itemprop="wordCount" content="4479"><meta itemprop="image" content="https://doc.sireum.org"/>
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://doc.sireum.org"/>

<meta name="twitter:title" content="Lecture Summary: Loop Unfolding"/>
<meta name="twitter:description" content="Induction, Recursion, Iteration From Specification to Implementation Let&rsquo;s review the material from last week, linking induction, recursion and iteration.
We have developed a correct implementation in three steps.
Describe the mathematical concepts necessary to express required program properties Create a (recursive) specification that is easy to understand (and validate) Implement an efficient solution for the specification We document clearly what is implemented by specifying it in mathematical terms. We document clearly why the implementation is correct by supplying a proof."/>







    <meta property="article:published_time" content="2022-11-24 17:01:09 &#43;0100 &#43;0100" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="menu-trigger">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
        </svg>
    </span>
    <span class="header__inner">
        <a href="https://doc.sireum.org/" style="text-decoration: none;">
    <div class="logo">
        
            <img class="color-scheme" src="https://doc.sireum.org/img/santos/icon-doc.png" alt="">
            &nbsp;<span class="logo__text">Doc</span>
        
    </div>
</a>


        <span class="header__right">
            
                

<nav class="menu">
  <ul class="menu__inner">
  
  
    
      <div class="submenu">
        <li class="dropdown" onmouseover="menuDisplay(this.children[1], true);" onmouseout="menuDisplay(this.children[1], false);">
          <a class="dropbtn" href="https://doc.sireum.org/volumes/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Volumes&nbsp;<small>ᐁ</small></span>
            <span class="responsive-title-short">Volumes&nbsp;<small>ᐁ</small></span>
          </a>
          <div class="dropdown-content" align="left">
            <ul style="margin:8px;">
              
                
  
  
    
      <div>
        <li>
          <a href="https://doc.sireum.org/volumes/slang/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Slang</span>
            <span class="responsive-title-short">Slang</span>
          </a>
        </li>
      </div>
    
  

              
                
  
  
    
      <div>
        <li>
          <a href="https://doc.sireum.org/volumes/hamr/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">HAMR</span>
            <span class="responsive-title-short">HAMR</span>
          </a>
        </li>
      </div>
    
  

              
                
  
  
    
      <div>
        <li>
          <a href="https://doc.sireum.org/volumes/logika" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Logika</span>
            <span class="responsive-title-short">Logika</span>
          </a>
        </li>
      </div>
    
  

              
            </ul>
          </div>
        </li>
      </div>
    
  

  
  
    
      <div class="submenu">
        <li class="dropdown" onmouseover="menuDisplay(this.children[1], true);" onmouseout="menuDisplay(this.children[1], false);">
          <a class="dropbtn" href="https://doc.sireum.org/venues/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Venues&nbsp;<small>ᐁ</small></span>
            <span class="responsive-title-short">Venues&nbsp;<small>ᐁ</small></span>
          </a>
          <div class="dropdown-content" align="left">
            <ul style="margin:8px;">
              
                
  
  
    
      <div>
        <li>
          <a href="https://doc.sireum.org/venues/tutorials/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Tutorials</span>
            <span class="responsive-title-short">Tutorials</span>
          </a>
        </li>
      </div>
    
  

              
                
  
  
    
      <div>
        <li>
          <a href="https://doc.sireum.org/venues/presentations/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Presentations</span>
            <span class="responsive-title-short">Presentations</span>
          </a>
        </li>
      </div>
    
  

              
            </ul>
          </div>
        </li>
      </div>
    
  

  
  
    
      <div>
        <li>
          <a href="https://sireum.org/getting-started/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Download</span>
            <span class="responsive-title-short">Download</span>
          </a>
        </li>
      </div>
    
  

  
  
    
      <div>
        <li>
          <a href="https://sireum.org/papers" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Papers</span>
            <span class="responsive-title-short">Papers</span>
          </a>
        </li>
      </div>
    
  

  
  
    
      <div>
        <li>
          <a href="https://sireum.org/funding" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Funding</span>
            <span class="responsive-title-short">Funding</span>
          </a>
        </li>
      </div>
    
  

  
  
    
      <div>
        <li>
          <a href="https://sireum.org/team" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">
            <span class="responsive-title-long">Team</span>
            <span class="responsive-title-short">Team</span>
          </a>
        </li>
      </div>
    
  

  </ul>
</nav>

            
        </span>
    </span>
        <span class="theme-toggle not-selectable" style="margin-right: 10px"><img src="https://doc.sireum.org/img/toggle.png" height="20px"></span>
      <div class="submenu">
          <li class="dropdown" onmouseover="menuDisplay(this.children[1], true); searchFocus();" onmouseout="menuDisplay(this.children[1], false);">
              <a class="dropbtn fa fa-search"></a>
              <div class="dropdown-content" align="left">
                  <div id="search" style="z-index:2147483647; position: fixed;"></div>
              </div>
          </li>
      </div>
    
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://doc.sireum.org/volumes/logika/courses/software-correctness/lecture-summaries/lectures-08-loop-unfolding/lecture-08-loop-unfolding/">Lecture Summary: Loop Unfolding</a></h2>

            
            
            
                <hr />
                <aside id="toc">
                <div class="toc-title">Table of Contents</div>
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#induction-recursion-iteration">Induction, Recursion, Iteration</a>
      <ul>
        <li><a href="#from-specification-to-implementation">From Specification to Implementation</a></li>
        <li><a href="#example-multiplication-by-repeated-addition">Example: Multiplication by Repeated Addition</a></li>
        <li><a href="#multiplication-by-repeated-addition-in-slang">Multiplication by Repeated Addition in Slang</a></li>
        <li><a href="#program-specification">Program Specification</a></li>
        <li><a href="#program-implementation">Program Implementation</a></li>
        <li><a href="#exercise-1">Exercise 1</a></li>
      </ul>
    </li>
    <li><a href="#recursion-unfolding">Recursion Unfolding</a>
      <ul>
        <li><a href="#example-counting-down-recursively">Example: Counting Down Recursively</a></li>
        <li><a href="#recursively-unfolding-counting-down">Recursively Unfolding Counting Down</a></li>
        <li><a href="#recursively-unfolding-lambda-using-fp2">Recursively Unfolding Lambda Using (FP2)</a></li>
        <li><a href="#recursive-unfolding-vs-direct-calculation">Recursive Unfolding Vs Direct Calculation</a></li>
        <li><a href="#unfolding-with-parameters-using-fp1">Unfolding with Parameters using (FP1)</a></li>
        <li><a href="#unfolded-recursive-programs-as-facts">Unfolded Recursive Programs as Facts</a></li>
        <li><a href="#slang-examples-counting-down-and-the-factorial-function">Slang Examples: Counting Down and the Factorial Function</a></li>
        <li><a href="#recursive-counting-down-and-unfolding-in-logika">Recursive Counting Down and Unfolding in Logika</a></li>
        <li><a href="#exercise-2-recursive-factorial-unfolding">Exercise 2: Recursive Factorial Unfolding</a></li>
      </ul>
    </li>
    <li><a href="#iteration-unfolding">Iteration Unfolding</a>
      <ul>
        <li><a href="#example-counting-down-iteratively">Example: Counting Down Iteratively</a></li>
        <li><a href="#loop-unfolding-using-fp3">Loop Unfolding using (FP3)</a></li>
        <li><a href="#unfolding-the-iterative-slang-counting-down-function">Unfolding the Iterative Slang Counting Down Function</a></li>
        <li><a href="#recursive-counting-down-and-unfolding-in-logika-1">Recursive Counting Down and Unfolding in Logika</a></li>
        <li><a href="#exercise-3-iterative-factorial-unfolding">Exercise 3: Iterative Factorial Unfolding</a></li>
      </ul>
    </li>
    <li><a href="#symbolic-execution-with-unfolding">Symbolic Execution with Unfolding</a>
      <ul>
        <li><a href="#symbolic-execution-with-recursion">Symbolic Execution with Recursion</a></li>
      </ul>
    </li>
    <li><a href="#symbolic-execution-with-iteratio">Symbolic Execution with Iteratio</a></li>
    <li><a href="#slang-examples">Slang Examples</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
                </aside>
                <hr />
            

            <div class="post-content">
                <h3 id="induction-recursion-iteration">Induction, Recursion, Iteration</h3>
<h4 id="from-specification-to-implementation">From Specification to Implementation</h4>
<p>Let&rsquo;s review the material from last week, linking induction, recursion and iteration.</p>
<p>We have developed a correct implementation in three steps.</p>
<ol>
<li>Describe the mathematical concepts necessary to express required program properties</li>
<li>Create a (recursive) specification that is easy to understand (and validate)</li>
<li>Implement an efficient solution for the specification</li>
</ol>
<p>We document clearly <strong>what</strong> is implemented by specifying it in mathematical terms.
We document clearly <strong>why</strong> the implementation is correct by supplying a proof.
Instead of a proof we also accept other evidence of correctness such as successful tests.</p>
<p>Today we make preparations for systematic testing of loops and recursive functions.</p>
<p>But first let&rsquo;s refresh our memory of induction, recursion and iteration.</p>
<h4 id="example-multiplication-by-repeated-addition">Example: Multiplication by Repeated Addition</h4>
<p>We can express multiplication of two natural numbers by repeated addition.
<code>m * n = (n + n + ... + n)</code> &lt;- <code>n</code> times
The repeated addition on the right-hand side can be expressed recursively.</p>
<pre tabindex="0"><code>0 * n = 0  
m&#39; n = m * n + n
</code></pre><p>Using the recursive definition of multiplication we can calculate:</p>
<pre tabindex="0"><code>3 * 1 
= 2 * 1 + 1  
= 1 * 1 + 1 + 1
= 0 * 1 + 1 + 1 + 1  
= 0 + 1 + 1 + 1
</code></pre><p>Let&rsquo;s specify it in Slang</p>
<h4 id="multiplication-by-repeated-addition-in-slang">Multiplication by Repeated Addition in Slang</h4>
<p>We specify <code>mult_spec</code> using the inductive definition of the natural numbers.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@strictpure</span> <span class="k">def</span> <span class="n">mult_spec</span><span class="o">(</span><span class="n">m</span><span class="k">:</span> <span class="kt">Z</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">m</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="mi">0</span> <span class="k">=&gt;</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="n">k</span> <span class="k">=&gt;</span> <span class="n">mult_spec</span><span class="o">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="o">+</span> <span class="n">n</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>where <code>k - 1</code> denotes the predecessor of natural number <code>k</code>.</p>
<p>Induction rules for <code>mult_spec</code>:</p>
<p>Base case (<code>m == 0</code>):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">mult_spec_0</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="n">mult_spec</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Inductive case (<code>m &gt; 0</code>):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">mult_spec_step</span><span class="o">(</span><span class="n">m</span><span class="k">:</span> <span class="kt">Z</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="n">mult_spec</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="o">==</span> <span class="n">mult_spec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="o">+</span> <span class="n">n</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Logika applies these rules automatically.</p>
<h4 id="program-specification">Program Specification</h4>
<p>We can write a specification for a multiplication function:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span><span class="k">:</span> <span class="kt">Z</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="nc">Res</span> <span class="o">==</span> <span class="n">mult_spec</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">(</span><span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="o">+</span> <span class="n">n</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Of course, in this simple example the structure of the recursive specification resembles closely that of the mathematical definition.
As a consequence, Logika proves the post-condition fully-automatically.</p>
<h4 id="program-implementation">Program Implementation</h4>
<p>We can implement the program using a while loop.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">mult_it</span><span class="o">(</span><span class="n">m</span><span class="k">:</span> <span class="kt">Z</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="nc">Res</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">i</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">m</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">k</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Invariant</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    	<span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>where variables <code>i</code> and <code>k</code> are modified until <code>k</code> contains the product.</p>
<h4 id="exercise-1">Exercise 1</h4>
<ol type="a">
    <li>Implement function <code>mult_it</code></li>
    <li>Formulate an invariant</li>
    <ul>
        <li>Hint: Use backward conjecture to find a candidate for the invariant</li>
    </ul>
    <li>Insert deductions that document why the program is correct</li>
    <li>Prove and document that the function terminates</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">mult_it</span><span class="o">(</span><span class="n">m</span><span class="k">:</span> <span class="kt">Z</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="nc">Res</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">i</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">m</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">k</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Invariant</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    	<span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="recursion-unfolding">Recursion Unfolding</h3>
<h4 id="example-counting-down-recursively">Example: Counting Down Recursively</h4>
<p>We can specify counting down recursively as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">cd</span><span class="o">(</span><span class="n">k</span><span class="o">)</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">       <span class="n">k</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">       <span class="n">cd</span><span class="o">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can calculate <code>cd(2)</code> observing the value of the parameter <code>k</code> at each invocation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">cd</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">2</span> <span class="n">and</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="n">cd</span><span class="o">(</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="n">cd</span><span class="o">(</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="mi">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s rename <code>k</code> at each invocation to clarify what&rsquo;s going on.</p>
<p>We rename <code>k</code> into <code>k0, k1, k2, ...</code> counting upwards.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">cd</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span> <span class="n">k0</span> <span class="o">==</span> <span class="mi">2</span> <span class="n">and</span> <span class="n">k0</span> <span class="o">!=</span><span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="n">cd</span><span class="o">(</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span> <span class="n">k1</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">k1</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="n">cd</span><span class="o">(</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span> <span class="n">k2</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">k2</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="mi">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, let&rsquo;s replace sub-expressions by the names of the parameters holding those values.</p>
<p>Using <code>k0, k1, k2</code> we get:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">cd</span><span class="o">(</span><span class="n">k0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span> <span class="n">k0</span> <span class="o">==</span> <span class="mi">2</span> <span class="n">and</span> <span class="n">k0</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="n">cd</span><span class="o">(</span><span class="n">k0</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span> <span class="n">k1</span> <span class="o">==</span> <span class="n">k0</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">k1</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="n">cd</span><span class="o">(</span><span class="n">k1</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span> <span class="n">k2</span> <span class="o">==</span> <span class="n">k1</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">k2</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="n">k2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Only focusing on the value of the parameter and ignoring the initial value <code>2</code>, we observe:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">k0</span> <span class="o">!=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">k1</span> <span class="o">==</span> <span class="n">k0</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">k1</span> <span class="o">!=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">k2</span> <span class="o">==</span> <span class="n">k1</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">k2</span> <span class="o">==</span> <span class="mi">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="recursively-unfolding-counting-down">Recursively Unfolding Counting Down</h4>
<p>The observation</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">k0</span> <span class="o">!=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">k1</span> <span class="o">==</span> <span class="n">k0</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">k1</span> <span class="o">!=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">k2</span> <span class="o">==</span> <span class="n">k1</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">k2</span> <span class="o">==</span> <span class="mi">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>describes the computation starting with the call <code>cd(2)</code> in terms of the parameter values.
Note, the final <code>k2 == 0</code> which determines that the first branch is chosen and <code>k2</code> is returned.
We can read the function definition as an equation.</p>
<p><code>cd(k) == if(k == 0) k else cd(k - 1)</code>, (FP1)</p>
<p>Using lambda notation,</p>
<p><code>cd == λk * if(k == 0) k else cd(k - 1)</code>, (FP2)</p>
<p>Theses two equations are called a <strong>fix-point equations</strong>.
Replacing the left-hand side by the right-hand side in either (FP1) or (FP2) is called <strong>unfolding</strong>.
Let&rsquo;s consider (FP2) first and then apply what we&rsquo;ve learned to (FP1).</p>
<h4 id="recursively-unfolding-lambda-using-fp2">Recursively Unfolding Lambda Using (FP2)</h4>
<p>Unfolding is a calculation that the function itself as a value.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">cd</span>  
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="n">λk</span> <span class="err">·</span> <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">k</span> <span class="k">else</span> <span class="n">cd</span><span class="o">(</span><span class="n">k</span> <span class="o">−</span> <span class="mi">1</span><span class="o">)</span>  
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="n">λk</span> <span class="err">·</span> <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">k</span> <span class="k">else</span> <span class="o">(</span><span class="n">λk</span> <span class="err">·</span> <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">k</span> <span class="k">else</span> <span class="n">cd</span><span class="o">(</span><span class="n">k</span> <span class="o">−</span> <span class="mi">1</span><span class="o">))(</span><span class="n">k</span> <span class="o">−</span> <span class="mi">1</span><span class="o">)</span>    
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="n">λk</span> <span class="err">·</span> <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">k</span> <span class="k">else</span> <span class="o">(</span><span class="n">λk</span> <span class="err">·</span> <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">k</span> <span class="k">else</span> <span class="o">(</span><span class="n">λk</span> <span class="err">·</span> <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">k</span> <span class="k">else</span> <span class="n">cd</span><span class="o">(</span><span class="n">k</span> <span class="o">−</span> <span class="mi">1</span><span class="o">))(</span><span class="n">k</span> <span class="o">−</span> <span class="mi">1</span><span class="o">))(</span><span class="n">k</span> <span class="o">−</span> <span class="mi">1</span><span class="o">)</span>  
</span></span></code></pre></div><ul>
<li>Let’s colour the different k’s bound by the lambdas</li>
</ul>
<p><code>cd2 = λk · if (k == 0) k else (λk · if (k == 0) k else (λk · if (k == 0) k else cd(k − 1))(k − 1))(k − 1)  </code></p>
<ul>
<li>Let’s call this function cd2</li>
<li>Now let <code>k0, k1 == k0 − 1, k2 == k1 − 1</code> be given, and calculate</li>
</ul>
<pre tabindex="0"><code>cd2(k0)  
= if (k0 == 0) k0 else (λk · if (k == 0) k else (λk · if (k == 0) k else cd(k − 1))(k − 1))(k0 − 1)  
= if (k0 == 0) k0 else (λk · if (k == 0) k else (λk · if (k == 0) k else cd(k − 1))(k − 1))(k1)  
= if (k0 == 0) k0 else if (k1 == 0) k1 else (λk · if (k == 0) k else cd(k − 1))(k1 − 1)  
= if (k0 == 0) k0 else if (k1 == 0) k1 else (λk · if (k == 0) k else cd(k − 1))(k2)  
= if (k0 == 0) k0 else if (k1 == 0) k1 else if (k2 == 0) k2 else cd(k2 − 1)  
</code></pre><ul>
<li>Let’s compare this to our initial observation for the computation of cd(2)</li>
</ul>
<h4 id="recursive-unfolding-vs-direct-calculation">Recursive Unfolding Vs Direct Calculation</h4>
<p>Given <code>k0, k1 == k0 − 1, k2 == k1 − 1</code>, we have<br>
<code>if (k0 == 0) k0 else if (k1 == 0) k1 else if (k2 == 0) k2 else cd(k2 − 1) (1)</code><br>
The observation</p>
<pre tabindex="0"><code>k0 != 0  
k1 == k0 − 1 and k1 != 0  
k2 == k1 − 1 and k2 == 0  
</code></pre><p>describes the situation where expression (1) returns <code>k2</code><br>
This is the case when <code>k0 == 2</code><br>
In other words, when <code>cd(2)</code> is called<br>
Next let’s consider the fix-point equation <code>cd(k) == if (k == 0) k else cd(k − 1)</code><br>
We begin by unfolding it</p>
<h4 id="unfolding-with-parameters-using-fp1">Unfolding with Parameters using (FP1)</h4>
<p>Using <code>cd(k) == if (k == 0) k else cd(k − 1)</code>, we calculate</p>
<pre tabindex="0"><code>cd(k0)  
= if (k0 == 0) k0 else cd(k0 − 1)
</code></pre><ul>
<li>Letting k1 == k0 − 1</li>
</ul>
<pre tabindex="0"><code>= if (k0 == 0) k0 else cd(k1)  
= if (k0 == 0) k0 else if (k1 == 0) k1 else cd(k1 − 1)
</code></pre><ul>
<li>Letting k2 == k1 − 1</li>
</ul>
<pre tabindex="0"><code>= if (k0 == 0) k0 else if (k1 == 0) k1 else cd(k2)  
= if (k0 == 0) k0 else if (k1 == 0) k1 else if (k2 == 0) k2 else cd(k2 − 1)
</code></pre><p>Fix-point equation version (FP2) describes a function as its solution<br>
This function can be used to observe computations via unfolding<br>
Fix-point equation version (FP1) can be used directly for unfolding and observation<br>
It hides the steps involving lambda abstraction and application<br>
To keep track of consecutive parameter values we introduce new variables at each call</p>
<h4 id="unfolded-recursive-programs-as-facts">Unfolded Recursive Programs as Facts</h4>
<p>Let’s state the expression
<code>if (k0 == 0) k0 else if (k1 == 0) k1 else if (k2 == 0) k2 else cd(k2 − 1)</code>
as a statement where the result value is assigned to a variable Res</p>
<pre tabindex="0"><code>if (k0 == 0)  
Res = k0        (k0 == 0 =&gt; Res == k0) &amp;                                call cd(0)
else            (k0 != 0 =&gt; k1 == k0 − 1) &amp;
if (k1 == 0)
Res = k1        (k0 != 0 &amp; k1 == 0 =&gt; Res == k1) &amp;                      call cd(1)
else            (k0 != 0 &amp; k1 != 0 =&gt; k2 == k1 − 1) &amp;
if (k2 == 0)
Res = k2        (k0 != 0 &amp; k1 != 0 &amp; k2 == 0 =&gt; Res = k2)
else            &amp;
Res = cd(k2 − 1)(k0 != 0 &amp; k1 != 0 &amp; k2 != 0 =&gt; Res == cd(k2 − 1))
</code></pre><p>Within the fact for the unfolded function we also discover our original observation for <code>cd(2)</code>
The two shorter cases deal with the calls <code>cd(0)</code> and <code>cd(1)</code></p>
<h4 id="slang-examples-counting-down-and-the-factorial-function">Slang Examples: Counting Down and the Factorial Function</h4>
<p>The count-down function in Slang:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">count0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">count0</span><span class="o">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>With a separate function specifying its correctness:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">count0_0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="n">count0</span><span class="o">(</span><span class="n">k</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can unfold function <code>count0</code> in Slang.
We do it within the body of the function.</p>
<p>The function itself:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">count0</span><span class="o">(</span><span class="n">k0</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">(</span><span class="n">k0</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">k0</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">count0</span><span class="o">(</span><span class="n">k0</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>First Unfolding:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">count0</span><span class="o">(</span><span class="n">k0</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">(</span><span class="n">k0</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">k0</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">k1</span> <span class="k">=</span> <span class="n">k0</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">k1</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">k1</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">count0</span><span class="o">(</span><span class="n">k1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Second Unfolding:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">count0</span><span class="o">(</span><span class="n">k0</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">(</span><span class="n">k0</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">k0</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">k1</span> <span class="k">=</span> <span class="n">k0</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">k1</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">k1</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">k2</span> <span class="k">=</span> <span class="n">k1</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="o">(</span><span class="n">k2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">k2</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">count0</span><span class="o">(</span><span class="n">k2</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can see the effect of recursive unfolding in Slang.
It occurs when <em>inter-procedural</em> check is chosen.</p>
<h4 id="recursive-counting-down-and-unfolding-in-logika">Recursive Counting Down and Unfolding in Logika</h4>
<p>Let&rsquo;s inter-procedurally check the post-condition <code>count0(k) == 0</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">count0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">count0</span><span class="o">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">count0_0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="n">count0</span><span class="o">(</span><span class="n">k</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>of function <code>count0_0</code>.</p>
<div style="display: grid; grid-template-columns: 16.66% 16.66% 16.66% 16.66% 16.66% 16.66%">
<div class="col">
<p><img src="../images/Rec-Interproc-1.png" alt="Rec-Interproc-1"></p>
</div>
<div class="col">
<p><img src="../images/Rec-Interproc-2.png" alt="Rec-Interproc-2"></p>
</div>
<div class="col">
<p><img src="../images/Rec-Interproc-3.png" alt="Rec-Interproc-3"></p>
</div>
<div class="col">
<p><img src="../images/Rec-Interproc-4.png" alt="Rec-Interproc-4"></p>
</div>
<div class="col">
<p><img src="../images/Rec-Interproc-5.png" alt="Rec-Interproc-5">
Unfolded if-branch</p>
</div>
<div class="col">
<p><img src="../images/Rec-Interproc-6.png" alt="Rec-Interproc-6">
Unfolded else-branch</p>
</div>
</div>
<h4 id="exercise-2-recursive-factorial-unfolding">Exercise 2: Recursive Factorial Unfolding</h4>
<p>Unfold function <code>fac_rec</code> two times.
Write down the fact for the unfolded function.
Inter-procedurally check the post-condition <code>fac_rec(n) == fac_rec_spec(n)</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">fac_rec</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">fac_rec</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">fac_rec_lemma</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="n">fac_rec</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">==</span> <span class="n">fac_rec_spec</span><span class="o">(</span><span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>of function <code>fac_rec_lemma</code>.</p>
<h3 id="iteration-unfolding">Iteration Unfolding</h3>
<h4 id="example-counting-down-iteratively">Example: Counting Down Iteratively</h4>
<p>We can specify counting down recursively as follows.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">cd</span><span class="o">(</span><span class="n">k</span><span class="o">)</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">m</span> <span class="k">=</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">m</span> <span class="k">=</span> <span class="n">m</span> <span class="o">−</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="n">m</span>
</span></span></code></pre></div><p>Where the tailing <code>m</code> is the returned result.
We can calculate <code>cd(2)</code> observing the value of the local variable $m$ at each iteration.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">cd</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">{</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">2</span> <span class="n">and</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">{</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">−</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">{</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">−</span> <span class="mi">1</span> <span class="o">−</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">m</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="mi">0</span>
</span></span></code></pre></div><p>It would be convenient if we could observe iterative programs similarly to recursive programs.
Recall the similarity between tail-recursion and while-loops.</p>
<p>We rename k into <code>m0, m1, m2, . . .</code> counting upwards.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">cd</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">{</span> <span class="n">m0</span> <span class="o">==</span> <span class="mi">2</span> <span class="n">and</span> <span class="n">m0</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">{</span> <span class="n">m1</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">−</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">m1</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">{</span> <span class="n">m2</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">−</span> <span class="mi">1</span> <span class="o">−</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">m2</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="mi">0</span>
</span></span></code></pre></div><p>and replace sub-expressions by variable names.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">cd</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">{</span> <span class="n">m0</span> <span class="o">==</span> <span class="mi">2</span> <span class="n">and</span> <span class="n">m0</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">{</span> <span class="n">m1</span> <span class="o">==</span> <span class="n">m0</span> <span class="o">−</span> <span class="mi">1</span> <span class="n">and</span> <span class="n">m1</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">{</span> <span class="n">m2</span> <span class="o">==</span> <span class="n">m1</span> <span class="o">−</span> <span class="mi">0</span> <span class="n">and</span> <span class="n">m2</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">=</span> <span class="mi">0</span>
</span></span></code></pre></div><p>This is exactly the same pattern we have observed for recursion.
Let’s look for a fix-point equation.</p>
<p>We focus on the iterative part of the body of function cd.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">m</span> <span class="k">=</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span> 
</span></span><span class="line"><span class="cl">  <span class="n">m</span> <span class="k">=</span> <span class="n">m</span> <span class="o">−</span> <span class="mi">1</span>
</span></span></code></pre></div><p>To observe one step of the execution of the loop we consider the following.
If the condition <code>m &gt; 0</code> is true, we execute the loop body and the execute the loop
again.
<code>m = m − 1; while (m &gt; 0) m = m − 1</code>
If the condition is false, the loop is exited
(and the statement following the loop may be executed).
The above describes a conditional with an empty else-branch.<br>
We have (in italics):
<em><strong>while</strong></em> <em>(m &gt; 0) m = m − 1</em> == <strong>if</strong> (m &gt; 0) { m = m − 1; <em><strong>while</strong></em> <em>(m &gt; 0) m = m − 1</em> } (FP3)
The loop is a solution of fix-point equation (FP3).
We can use it for unfolding while-loops.</p>
<h4 id="loop-unfolding-using-fp3">Loop Unfolding using (FP3)</h4>
<p>Using
<code>while (m &gt; 0) m = m − 1 == if (m &gt; 0) { m = m − 1; while (m &gt; 0) m = m − 1 }</code>,
abbreviating <code>while (m &gt; 0) m = m − 1</code> with <code>W</code>, we calculate.</p>
<pre tabindex="0"><code>while (m &gt; 0) m = m − 1  
= if (m &gt; 0) { m = m − 1; W }  
= if (m &gt; 0) { m = m − 1; if (m &gt; 0) { m = m − 1; W } }  
= if (m &gt; 0) { m = m − 1; if (m &gt; 0) { m = m − 1; if (m &gt; 0) { m = m − 1; W } } }  

More readable this is           . . . and as a fact  
if (m &gt; 0)                      (m0 &lt;= 0 =&gt; m == m0) &amp;
  m = m − 1                     (m0 &gt; 0 =&gt; m1 == m0 − 1) &amp;  
    if (m &gt; 0)                  (m0 &gt; 0 &amp; m1 &lt;= 0 =&gt; m == m1) &amp;  
      m = m − 1                 (m0 &gt; 0 &amp; m1 &gt; 0 =&gt; m2 = m1 − 1) &amp;  
        if (m &gt; 0)              (m0 &gt; 0 &amp; m1 &gt; 0 &amp; m1 &lt;= 0 =&gt; m == m2) &amp;  
          m = m − 1             . . .
          W
</code></pre><p>The complete body of the loop unfolded twice:</p>
<pre tabindex="0"><code>m0 == k  
(m0 &lt;= 0 =&gt; m == m0) &amp;  
(m0 &gt; 0 =&gt; m1 == m0 − 1) &amp;  
(m0 &gt; 0 &amp; m1 &lt;= 0 =&gt; m == m1) &amp;  
(m0 &gt; 0 &amp; m1 &gt; 0 =&gt; m2 = m1 − 1) &amp;  
(m0 &gt; 0 &amp; m1 &gt; 0 &amp; m1 &lt;= 0 =&gt; m == m2) &amp;  
Res == m
</code></pre><p>Note the similarity of the structure of the formula.
with respect to the variables m0, m1, m2 in the iterative case.
and the variables k0, k1, k2 in the recursive case.
In the iterative case the variables occur as a consequence of consecutive assignments.
In the recursive case they occur as a consequence of consecutive parameter passing.</p>
<h4 id="unfolding-the-iterative-slang-counting-down-function">Unfolding the Iterative Slang Counting Down Function</h4>
<p>The function itself:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">while0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="o">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">m</span> <span class="k">=</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">m</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>First Unfolding:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">while0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">m</span> <span class="k">=</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="o">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">m</span> <span class="k">=</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">m</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Second Unfolding:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">while0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">m</span> <span class="k">=</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">m</span> <span class="k">=</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">      <span class="k">while</span> <span class="o">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">m</span> <span class="k">=</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">m</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can see the effect of recursive unfolding in Slang.
It occurs when <em>inter-procedural</em> check is chosen.</p>
<h4 id="recursive-counting-down-and-unfolding-in-logika-1">Recursive Counting Down and Unfolding in Logika</h4>
<p>Let&rsquo;s inter-procedurally check the post-condition <code>count0(k) == 0</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">while0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="o">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">m</span> <span class="k">=</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">m</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">while0_0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="n">while0</span><span class="o">(</span><span class="n">k</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>of function <code>while0_0</code>.</p>
<div style="display: grid; grid-template-columns: 16.66% 16.66% 16.66% 16.66% 16.66% 16.66%">
<div class="col">
<p><img src="../images/It-Interproc-1.png" alt="It-Interproc-1"></p>
</div>
<div class="col">
<p><img src="../images/It-Interproc-2.png" alt="It-Interproc-2"></p>
</div>
<div class="col">
<p><img src="../images/It-Interproc-3.png" alt="It-Interproc-3"></p>
</div>
<div class="col">
<p><img src="../images/It-Interproc-4.png" alt="It-Interproc-4"></p>
</div>
<div class="col">
<p><img src="../images/It-Interproc-5.png" alt="It-Interproc-5"></p>
</div>
<div class="col">
<p><img src="../images/It-Interproc-6.png" alt="It-Interproc-6">
Second Unfolding</p>
</div>
</div>
<h4 id="exercise-3-iterative-factorial-unfolding">Exercise 3: Iterative Factorial Unfolding</h4>
<ol type="a">
    <li>Unfold the loop of the function <code>fac_it</code> two times</li>
    <li>Write down the fact for the unfolded function</li>
    <li>Inter-procedurally check the post-condition <code>fac_it(n) == fac_rec(n)</code></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">fac_it</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="o">(</span><span class="n">m</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">m</span> <span class="k">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="k">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">m</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">fac_it_rec_lemma</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="n">fac_it</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">==</span> <span class="n">fac_rec</span><span class="o">(</span><span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>of function <code>fac_it_rec_lemma</code>.</p>
<h3 id="symbolic-execution-with-unfolding">Symbolic Execution with Unfolding</h3>
<h4 id="symbolic-execution-with-recursion">Symbolic Execution with Recursion</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="hl"><span class="lnt">1
</span></span><span class="hl"><span class="lnt">2
</span></span><span class="hl"><span class="lnt">3
</span></span><span class="hl"><span class="lnt">4
</span></span><span class="hl"><span class="lnt">5
</span></span><span class="hl"><span class="lnt">6
</span></span><span class="hl"><span class="lnt">7
</span></span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line hl"><span class="cl"><span class="k">def</span> <span class="n">count0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line hl"><span class="cl">  <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line hl"><span class="cl">    <span class="k">return</span> <span class="n">k</span> <span class="c1">// Res = k
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line hl"><span class="cl">    <span class="k">return</span> <span class="n">count0</span><span class="o">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line hl"><span class="cl">  <span class="o">}</span>
</span></span><span class="line hl"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Executing <code>count0(k)</code> yields (<code>k: K0</code>), (PC: <code>true</code>)</p>
</li>
<li>
<p>Executing <code>if (k == 0) {</code> yields (<code>k: K0</code>), (PC: <code>K0 == 0</code>)</p>
</li>
<li>
<p>Executing <code>return k</code> yields (<code>k: K0, Res: K0</code>), (PC: <code>K0 == 0</code>)</p>
</li>
<li>
<p>Executing <code>count0(k)</code> yields (<code>k: K0</code>), (PC: <code>true</code>)</p>
</li>
<li>
<p>Executing <code>} else {</code> yields (<code>k: K0</code>), (PC: <code>K0 != 0</code>)</p>
</li>
<li>
<p>Executing <code>return count0(k - 1)</code> yields (<code>k: K1</code>), (PC: <code>K0 != 0, K1 == K0 - 1</code>)</p>
</li>
<li>
<p>Executing <code>if (k == 0) {</code> yields (<code>k: K1</code>), (PC: <code>K0 != 0, K1 == K0 - 1, K1 == 0</code>)</p>
</li>
<li>
<p>Executing <code>return k</code> yields (<code>k: K1, Res: K1</code>), (PC: <code>K0 != 0, K1 == K0 - 1, K1 == 0</code>)</p>
</li>
</ul>
<h3 id="symbolic-execution-with-iteratio">Symbolic Execution with Iteratio</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="hl"><span class="lnt">1
</span></span><span class="hl"><span class="lnt">2
</span></span><span class="hl"><span class="lnt">3
</span></span><span class="hl"><span class="lnt">4
</span></span><span class="hl"><span class="lnt">5
</span></span><span class="hl"><span class="lnt">6
</span></span><span class="hl"><span class="lnt">7
</span></span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line hl"><span class="cl"><span class="k">def</span> <span class="n">while0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line hl"><span class="cl">  <span class="k">var</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">k</span>
</span></span><span class="line hl"><span class="cl">  <span class="k">while</span> <span class="o">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line hl"><span class="cl">    <span class="n">m</span> <span class="k">=</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line hl"><span class="cl">  <span class="o">}</span>
</span></span><span class="line hl"><span class="cl">  <span class="k">return</span> <span class="n">m</span> <span class="c1">// Res = m
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Executing <code>while0(k)</code> yields (<code>k: K</code>), (PC: <code>true</code>)</p>
</li>
<li>
<p>Executing <code>var m: Z = k</code> yields (<code>k: K, m: K</code>), (PC: <code>true</code>)</p>
</li>
<li>
<p>Executing <code>}</code> yields (<code>k: K, m: K</code>), (PC: <code>K &lt;= 0</code>)</p>
</li>
<li>
<p>Executing <code>return m</code> yields (<code>k: K, m: K, Res: K</code>), (PC: <code>K &lt;= 0</code>)</p>
</li>
<li>
<p>Executing <code>while0(k)</code> yields (<code>k: K</code>), (PC: <code>true</code>)</p>
</li>
<li>
<p>Executing <code>var m: Z = k</code> yields (<code>k: K, m: K</code>), (PC: <code>true</code>)</p>
</li>
<li>
<p>Executing <code>while (m &gt; 0) {</code> yields (<code>k: K, m: K</code>), (PC: <code>K &gt; 0</code>)</p>
</li>
<li>
<p>Executing <code>m = m - 1</code> yields (<code>k: K, m: M1</code>), (PC: <code>K &gt; 0, M1 &gt; K - 1</code>)</p>
</li>
<li>
<p>Executing <code>}</code> yields (<code>k: K, m: M1</code>), (PC: <code>K &gt; 0, M1 &gt; K - 1, M1 &lt;= 0</code>)</p>
</li>
<li>
<p>Executing <code>return m</code> yields (<code>k: K, m: M1, Res: M1</code>), (PC: <code>K &gt; 0, M1 &gt; K - 1, M1 &lt;= 0</code>)</p>
</li>
</ul>
<h3 id="slang-examples">Slang Examples</h3>
<p>Count Int Loop Rec</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="c1">// #Sireum #Logika
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">import</span> <span class="nn">org.sireum._</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">while0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="o">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">m</span> <span class="k">=</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">m</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">while0_0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="n">while0</span><span class="o">(</span><span class="n">k</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">count0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">count0</span><span class="o">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">count0_0</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="n">count0</span><span class="o">(</span><span class="n">k</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Fac Function Loop Rec Unfolding</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="c1">// #Sireum #Logika
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">import</span> <span class="nn">org.sireum._</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1">// mathematically oriented specification of the factorial function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nd">@strictpure</span> <span class="k">def</span> <span class="n">fac_rec_spec</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">n</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mi">0</span> <span class="k">=&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">m</span> <span class="k">=&gt;</span> <span class="n">m</span> <span class="o">*</span> <span class="n">fac_rec_spec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// recursive implementation of the factorial function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nd">@pure</span> <span class="k">def</span> <span class="n">fac_rec</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// no contract: we will instead verify/test using a refinement approach
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">fac_rec</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// iterative/imperative implementation of the factorial function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nd">@pure</span> <span class="k">def</span> <span class="n">fac_it</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// no contract: we will instead verify/test using a refinement approach
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">var</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">var</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="o">(</span><span class="n">m</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">m</span> <span class="k">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">      <span class="n">x</span> <span class="k">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">m</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Refinement specification:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//  For all n &gt;= Z,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//   fac_it(n) refines (conforms to) fac_rec_spec(n)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//  i.e.,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//    fac_it(n) == fac_rec_spec(n)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nd">@pure</span> <span class="k">def</span> <span class="n">fac_imp_spec_refinement</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Requires</span><span class="o">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">assert</span><span class="o">(</span><span class="n">fac_it</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">==</span> <span class="n">fac_rec_spec</span><span class="o">(</span><span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Refinement specification:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//  For all n &gt;= Z,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//   fac_it(n) refines (conforms to) fac_rec(n)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//  i.e.,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//    fac_it(n) == fac_rec(n)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nd">@pure</span> <span class="k">def</span> <span class="n">fac_imp_rec_refinement</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Requires</span><span class="o">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">assert</span><span class="o">(</span><span class="n">fac_it</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">==</span> <span class="n">fac_rec</span><span class="o">(</span><span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Refinement specification:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//  For all n &gt;= Z,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//   fac_rec(n) refines (conforms to) fac_rec_spec(n)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//  i.e.,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//    fac_it(n) == fac_rec(n)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nd">@pure</span> <span class="k">def</span> <span class="n">fac_rec_spec_refinement</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Requires</span><span class="o">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">assert</span><span class="o">(</span><span class="n">fac_rec</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">==</span> <span class="n">fac_rec_spec</span><span class="o">(</span><span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Mult Add Rex It</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="c1">// #Sireum #Logika
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">import</span> <span class="nn">org.sireum._</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Inductive definition of multiplication
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nd">@strictpure</span> <span class="k">def</span> <span class="n">mult_spec</span><span class="o">(</span><span class="n">m</span><span class="k">:</span> <span class="kt">Z</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">m</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="mi">0</span> <span class="k">=&gt;</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="n">k</span> <span class="k">=&gt;</span> <span class="n">mult_spec</span><span class="o">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="o">+</span> <span class="n">n</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Induction rules
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">mult_spec_0</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="n">mult_spec</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">mult_spec_step</span><span class="o">(</span><span class="n">m</span><span class="k">:</span> <span class="kt">Z</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="n">mult_spec</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="o">==</span> <span class="n">mult_spec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="o">+</span> <span class="n">n</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">m</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">))</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pure</span> <span class="k">def</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span><span class="k">:</span> <span class="kt">Z</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="nc">Res</span> <span class="o">==</span> <span class="n">mult_spec</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">(</span><span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="o">+</span> <span class="n">n</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">mult_it</span><span class="o">(</span><span class="n">m</span><span class="k">:</span> <span class="kt">Z</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="nc">Res</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">i</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">m</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">k</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">i</span><span class="o">,</span> <span class="n">n</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Invariant</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Modifies</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">i</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">i</span><span class="o">,</span> <span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">i</span><span class="o">,</span> <span class="n">n</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">i</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="o">+</span> <span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="n">n</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="o">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="o">),</span> <span class="n">n</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">k</span> <span class="k">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">n</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="o">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="o">),</span> <span class="n">n</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="k">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">i</span><span class="o">,</span> <span class="n">n</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">i</span><span class="o">,</span> <span class="n">n</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">0</span><span class="o">,</span> <span class="n">n</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">n</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">mult_it_term</span><span class="o">(</span><span class="n">m</span><span class="k">:</span> <span class="kt">Z</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Z</span><span class="o">)</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Contract</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Requires</span><span class="o">(</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Ensures</span><span class="o">(</span><span class="nc">Res</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">i</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">m</span>
</span></span><span class="line"><span class="cl">  <span class="k">var</span> <span class="n">k</span><span class="k">:</span> <span class="kt">Z</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// decreases i
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nc">Invariant</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Modifies</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">i</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">      <span class="o">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">mult_rec</span><span class="o">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">i</span><span class="o">,</span> <span class="n">n</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">measure_i_pre</span> <span class="k">=</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">measure_i_pre</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">k</span> <span class="k">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">n</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="k">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">measure_i_post</span> <span class="k">=</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Deduce</span><span class="o">(|-</span> <span class="o">(</span><span class="n">measure_i_post</span> <span class="o">&lt;</span> <span class="n">measure_i_pre</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">k</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="summary">Summary</h3>
<ul>
<li>We have reviewed development and verification methodology for Slang programs</li>
<li>We have looked at unfolding of recursive functions</li>
<li>We have looked at unfolding of while-loops</li>
<li>We have considered fix-points that provide a justification for unfolding</li>
<li>We have looked at symbolic execution of recursive functions</li>
<li>We have looked at symbolic execution of while-loops</li>
</ul>

            </div>
        </article>

        <hr />

        
<div style="display: grid; grid-template-columns: 2% 49% 49%; text-align: center;">
  <div class="submenu" style="background: transparent; text-align: left; position: relative;">
    <li class="dropdown" onmouseover="menuDisplay(this.children[1], true);" onmouseout="menuDisplay(this.children[1], false);">
      <a class="dropbtn" href=""><i class="fa-solid fa-angles-up"></i></a>
      <div class="dropdown-content" style="bottom: 100%;"><a class="post-item-inner" href="https://doc.sireum.org/volumes/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">Volumes</a><a class="post-item-inner" href="https://doc.sireum.org/volumes/logika/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">Logika</a><a class="post-item-inner" href="https://doc.sireum.org/volumes/logika/courses/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">Course Materials</a><a class="post-item-inner" href="https://doc.sireum.org/volumes/logika/courses/software-correctness/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">Logika Course: Software Correctness</a><a class="post-item-inner" href="https://doc.sireum.org/volumes/logika/courses/software-correctness/lecture-summaries/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">Lecture Summaries</a><a class="post-item-inner" href="https://doc.sireum.org/volumes/logika/courses/software-correctness/lecture-summaries/lectures-08-loop-unfolding/" onmouseover="menuUnderline(this, true);" onmouseout="menuUnderline(this, false);">Loop Unfolding</a></div>
    </li>
  </div>
  <div style="text-align: left;">
    
  </div>
  <div style="text-align: right;">
    
  </div>
</div>



        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js" integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin="anonymous"></script>



<script type="text/javascript" src="https://doc.sireum.org/bundle.min.d9847dec188cb3ba71e262769d7f64069d223c3a9713999a5da5f7aca5638686e15a900ac07cc755d19861961f24145ef2d608296933e4150cae87f4911a7dbb.js" integrity="sha512-2YR97BiMs7px4mJ2nX9kBp0iPDqXE5maXaX3rKVjhobhWpAKwHzHVdGYYZYfJBRe8tYIKWkz5BUMrof0kRp9uw=="></script>


<script defer type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/thecarnie-cycle2/2.1.6c/jquery.cycle2.min.js" integrity="sha512-ydWfQuPu+srw5hhkU8O1XGn3/Kc+GyoDBvYc8E+SyuZKphQP18ZWYKywIFzPWZwQk6dlmTY69aDg/SnFz3qPeQ==" crossorigin="anonymous"></script>
<script defer type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/js/all.min.js" integrity="sha512-rpLlll167T5LJHwp0waJCh3ZRf7pO6IT1+LZOhAyP6phAirwchClbTZV3iqL3BMrVxIYRbzGTpli4rfxsCK6Vw==" crossorigin="anonymous"></script>
<script defer type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.14/jstree.min.js" integrity="sha512-OQ2by9SrJBwcXaeYmkG2t6FVZiwpyRtFar2VvULjuq5OjVpJLwsUHuNzN9PClqEJAYsWsRPSb4TTfriZzPGiow==" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://doc.sireum.org/_pagefind/pagefind-ui.js"></script>
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', (event) => {
      new PagefindUI({
        element: "#search",
        showEmptyFilters: true,
        mergeIndex: [
          
            { bundlePath: "https:\/\/sireum.org\/_pagefind" },
          
            { bundlePath: "https:\/\/slang.sireum.org\/_pagefind" },
          
            { bundlePath: "https:\/\/logika.sireum.org\/_pagefind" },
          
        ]
      });
    });
  </script>
<script style="text/javascript">
  window.addEventListener('load', function () {
    $('#page-tree').jstree({
      "core": {
        "themes": {
          "name": document.documentElement.getAttribute("data-theme") == "dark" ? "default-dark" : "default",
          "dots": true,
          "icons": false,
          "variant": "large"
        }
      },
      plugins: [ "ui" ],
    }).bind("select_node.jstree", function (e, data) {
      document.location.href = data.node.a_attr.href;
    }).bind("ready.jstree", function (event, data) {
      $(this).jstree("open_all");
    }).bind("open_all.jstree", function (event, data) {
      level = 0;
      data.instance.element.find('li').each(function() {
        if (level > 0 && data.instance.get_path(this).length >= level){
          data.instance.close_node(this);
        }
      });
      data.instance.element.get()[0].style.display="block";
    });
  });
</script>


    </body>
</html>
